generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String      @id @default(cuid())
  walletAddress String      @unique
  role          UserRole    @default(USER)
  bankDetails   BankDetails?
  orders        Order[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  
  @@map("users")
}

model BankDetails {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
  accountName   String   // AADHAR name
  accountNumber String
  ifscCode      String
  bankName      String
  branchName    String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@map("bank_details")
}

model Order {
  id                String      @id @default(cuid())
  blockchainOrderId Int?        // Smart contract order ID
  userId            String
  user              User        @relation(fields: [userId], references: [id])
  amount            Decimal
  orderType         OrderType
  status            OrderStatus @default(PENDING)
  paymentProof      String?     // CDM receipt image URL
  adminUpiId        String?     // UPI ID provided by admin
  adminBankDetails  String?     // Bank details provided by admin
  adminNotes        String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  @@map("orders")
}

enum UserRole {
  USER
  ADMIN
}

enum OrderType {
  BUY_UPI
  BUY_CDM
  SELL
}

enum OrderStatus {
  PENDING
  ADMIN_APPROVED
  PAYMENT_SUBMITTED
  COMPLETED
  CANCELLED
}
